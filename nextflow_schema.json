{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/dlejeune/nf-codon-alignment//nextflow_schema.json",
  "title": "dlejeune/nf-codon-alignment pipeline parameters",
  "description": "TODO",
  "type": "object",
  "$defs": {
    "input_output_options": {
      "title": "Input/output options",
      "type": "object",
      "fa_icon": "fas fa-terminal",
      "description": "Define where the pipeline should find input data and save output data.",
      "required": [
        "samplesheet",
        "sample_base_dir",
        "reference_file",
        "outdir"
      ],
      "properties": {
        "samplesheet": {
          "type": "string",
          "description": "The CSV file that specifies the various samples and metadata to feed into the pipeline",
          "format": "file-path",
          "mimetype": "text/csv",
          "fa_icon": "fas fa-file-csv"
        },
        "sample_base_dir": {
          "type": "string",
          "fa_icon": "far fa-folder",
          "description": "The directory where lookups for the files specified in the samplesheet will be made",
          "format": "directory-path"
        },
        "reference_file": {
          "type": "string",
          "fa_icon": "fas fa-file-import",
          "description": "The reference that contains the gene or CDS of interest. Note that this file type depends on the pre-processing mode selected.",
          "format": "file-path"
        },
        "outdir": {
          "type": "string",
          "format": "directory-path",
          "description": "The output directory where the results will be saved. You have to use absolute paths to storage on Cloud infrastructure.",
          "fa_icon": "fas fa-folder-open",
          "default": "./results/test"
        }
      }
    },
    "operating_modes": {
      "title": "Operating Modes",
      "type": "object",
      "description": "Paramters that change the operating mode of the pipeline",
      "default": "",
      "properties": {
        "aligner": {
          "type": "string",
          "default": "MAFFT",
          "description": "What aligner to use for the main alignment",
          "enum": [
            "MAFFT",
            "MUSCLE",
            "PROBCONS",
            "TCOFFEE",
            "TCOFFEE_REGRESSIVE",
            "PRANK"
          ],
          "fa_icon": "fas fa-align-center"
        },
        "multi_timepoint_alignment": {
          "type": "boolean",
          "description": "This run should produce timepoint-stacked alignments"
        }
      },
      "fa_icon": "fas fa-code-branch"
    },
    "custom_preprocess_arguments": {
      "title": "Custom Preprocess Arguments",
      "type": "object",
      "description": "Arguments that alter how the vaious preprocessing steps in the CUSTOM operating mode work",
      "default": "",
      "fa_icon": "fas fa-frog",
      "properties": {
        "prs_ts_operating_mode": {
          "type": "string",
          "default": "double-match",
          "fa_icon": "fas fa-broadcast-tower",
          "description": "What mode to use for trimming the sequences to the trimmed consensus",
          "enum": ["single-match", "double-match"]
        },
        "trim_consensus_alignment_mode": {
          "type": "string",
          "default": "local",
          "description": "What mode to use for aligning the consensus to the reference.",
          "enum": ["local", "custom", "local_custom"]
        },
        "trim_consensus_gap_open_penalty": {
          "type": "integer",
          "default": 5,
          "description": "The gap opening penalty to use for trimming to the consensus."
        },
        "trim_consensus_gap_extension_penalty": {
          "type": "integer",
          "default": 1,
          "description": "The gap extension penalty to use for trimming the consensus."
        }
      }
    },
    "aga_preprocess_arguments": {
      "title": "AGA Preprocess Arguments",
      "type": "object",
      "description": "Arguments altering how AGA functions when using it as the preprocessing strategy",
      "default": "",
      "help_text": "",
      "fa_icon": "fas fa-cat",
      "properties": {
        "region_of_interest": {
          "type": "string",
          "description": "The name of the CDS or protein that is to be extracted from the supplied files. Still required if not using AGA as a pre-processing step"
        },
        "region_shorthand": {
          "type": "string",
          "description": "What to shorten the region name to"
        },
        "aga_strip_char": {
          "type": "string",
          "default": ".",
          "description": "Not currently used and may be changed in the future"
        },
        "aga_args": {
          "type": "string",
          "default": "--local",
          "description": "If using the AGA preprocessing, what arguments to supply to AGA"
        }
      },
      "required": ["region_of_interest"]
    },
    "filtering_options": {
      "title": "Filtering Options",
      "type": "object",
      "description": "Options passed onto the functional filter",
      "default": "",
      "properties": {
        "ff_max_stop_pct": {
          "type": "integer",
          "default": 100,
          "description": "The maximum percentage along the read that a stop codon can find itself"
        },
        "ff_include_no_stop_codons": {
          "type": "boolean",
          "default": true,
          "description": "Allow sequences that do not contain any stop codons to be considered functional"
        },
        "ff_include_frameshifts": {
          "type": "boolean",
          "description": "Include sequences that potentially contain a frameshift to be considered functional"
        },
        "ff_acceptable_pct_loss": {
          "type": "number",
          "default": 0.2,
          "description": "An acceptable proportion (0-1) of the median protein length that can be lost before a sequence is considered non-functional",
          "minimum": 0,
          "maximum": 1
        },
        "ff_expected_length": {
          "type": "number",
          "description": "The expected length of the protein. If left blank, this is set to the median length of the sequences in the input."
        }
      },
      "fa_icon": "fas fa-filter"
    },
    "miscellaneous_process_arguments": {
      "title": "Miscellaneous Process Arguments",
      "type": "object",
      "description": "Arguments that can be supplied to the various third-party tools in the pipeline",
      "default": "",
      "fa_icon": "fas fa-ellipsis-h",
      "properties": {
        "mafft_fast_align_args": {
          "type": "string",
          "default": "--retree 1 --maxiterate 0",
          "description": "When using the custom pre-processing mode, what args to supply to MAFFT"
        },
        "mafft_args": {
          "type": "string",
          "default": "--localpair --maxiterate 1000",
          "description": "Arguments to supply to MAFFT if using it as the aligner"
        },
        "iqtree_args": {
          "type": "string",
          "description": "If building trees, what args to supply to IQTREE"
        },
        "tcoffee_regressive_args": {
          "type": "string",
          "default": "-nseq 100 -tree mbed -method clustalo_msa",
          "description": "Parameters to pass to TCoffee Regressive."
        },
        "pagan_args": {
          "type": "string",
          "description": "Parameters to pass to PAGAN."
        },
        "clustalo_args": {
          "type": "string",
          "default": "--iterations 2",
          "description": "Parameters to pass to Clustal Omega"
        },
        "probcons_consistency": {
          "type": "integer",
          "default": 2
        },
        "probcons_ir": {
          "type": "integer",
          "default": 100
        },
        "probcons_pre": {
          "type": "integer",
          "default": 0
        }
      }
    },
    "compute_options": {
      "title": "Compute Options",
      "type": "object",
      "description": "Parameters affecting computational resources",
      "default": "",
      "fa_icon": "fas fa-desktop",
      "properties": {
        "max_memory": {
          "type": "string",
          "default": "128.GB",
          "description": "The maximum amount of memory to be allocated to a process"
        },
        "max_cpus": {
          "type": "integer",
          "default": 16,
          "description": "The maximum number of CPU cores that can be allocated to a process"
        },
        "max_time": {
          "type": "string",
          "default": "240.h",
          "description": "The maximum amount of time that a process can be allowed to run for until it is killed"
        }
      }
    },
    "generic_options": {
      "title": "Generic options",
      "type": "object",
      "fa_icon": "fas fa-file-import",
      "description": "Less common options for the pipeline, typically set in a config file.",
      "help_text": "These options are common to all nf-core pipelines and allow you to customise some of the core preferences for how the pipeline runs.\n\nTypically these options would be set in a Nextflow config file loaded for all pipeline runs, such as `~/.nextflow/config`.",
      "properties": {
        "run_name": {
          "type": "string",
          "default": "test",
          "description": "A  human-readable identifier for this run",
          "fa_icon": "far fa-address-card"
        },
        "slurm_queue": {
          "type": "string",
          "default": "Main",
          "description": "If running on an HPC with slurm, what queue to use",
          "fa_icon": "fas fa-store-alt"
        },
        "log_dir": {
          "type": "string",
          "default": "./results/test/logs",
          "description": "Where to copy pipeline logs to",
          "hidden": true,
          "fa_icon": "fas fa-sticky-note"
        },
        "publish_dir_mode": {
          "type": "string",
          "default": "copy",
          "description": "The mode to handle output files. It is recommended not to touch this unless you know what you are doing",
          "hidden": true,
          "fa_icon": "far fa-copy"
        },
        "monochrome_logs": {
          "type": "boolean",
          "hidden": true
        },
        "trace_report_suffix": {
          "type": "string",
          "fa_icon": "fas fa-braille",
          "description": "Suffix to add to the trace report filename. Default is the date and time in the format yyyy-MM-dd_HH-mm-ss.",
          "hidden": true
        },
        "version": {
          "type": "boolean",
          "description": "Display version and exit.",
          "fa_icon": "fas fa-question-circle",
          "hidden": true
        }
      },
      "required": ["run_name"]
    }
  },
  "allOf": [
    {
      "$ref": "#/$defs/input_output_options"
    },
    {
      "$ref": "#/$defs/operating_modes"
    },
    {
      "$ref": "#/$defs/custom_preprocess_arguments"
    },
    {
      "$ref": "#/$defs/aga_preprocess_arguments"
    },
    {
      "$ref": "#/$defs/filtering_options"
    },
    {
      "$ref": "#/$defs/miscellaneous_process_arguments"
    },
    {
      "$ref": "#/$defs/compute_options"
    },
    {
      "$ref": "#/$defs/generic_options"
    }
  ],
  "properties": {
    "add_reference_to_sequences": {
      "type": "string"
    },
    "reference_to_add": {
      "type": "string"
    },
    "use_kmer_trimming": {
      "type": "boolean"
    },
    "trim_kmer_size": {
      "type": "integer",
      "default": 10
    },
    "trim_kmer_max_dist": {
      "type": "integer",
      "default": 2
    },
    "tcoffee_args": {
      "type": "string"
    },
    "prank_args": {
      "type": "string",
      "default": "+F"
    },
    "trim_method": {
      "type": "string",
      "default": "AGA",
      "enum": ["AGA", "CUSTOM"]
    },
    "skip_pre_process": {
      "type": "boolean"
    },
    "skip_trim": {
      "type": "boolean"
    },
    "skip_functional_filter": {
      "type": "boolean"
    }
  }
}
